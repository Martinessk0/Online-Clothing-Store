<div class="max-w-3xl mx-auto px-4 py-8">
  @if (isLoading) {
    <div class="flex justify-center py-10">
      <p class="text-gray-500 text-sm">Зареждане на профила...</p>
    </div>
  } @else if (error) {
    <div class="bg-red-50 border border-red-200 text-red-700 text-sm rounded-lg px-4 py-3 dark:bg-red-950/40 dark:border-red-500/40 dark:text-red-200">
      {{ error }}
    </div>
  } @else if (profile) {

        @if (!profile.emailConfirmed) {
      <div
        class="mb-4 rounded-xl border border-amber-400 bg-amber-50 px-4 py-3 text-sm text-amber-800
               dark:bg-amber-950/40 dark:border-amber-500/60 dark:text-amber-100">
        Имейлът ти все още не е потвърден. Провери пощата си и използвай линка
        за потвърждение. Докато не го направиш, част от функционалностите
        (поръчки, детайли за поръчки и др.) са ограничени.
      </div>
    }


    <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-2xl shadow-sm p-6 space-y-6">

      <!-- Горна част -->
      <div class="flex flex-col sm:flex-row sm:items-center gap-4 sm:gap-6">
        <!-- Аватар -->
        <div
          class="h-16 w-16 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl font-semibold mx-auto sm:mx-0"
        >
          {{ avatarLetter }}
        </div>

        <div class="text-center sm:text-left flex-1">
          <h1 class="text-xl sm:text-2xl font-semibold text-gray-900 dark:text-gray-100">
            {{ displayName }}
          </h1>
          <p class="text-sm text-gray-500 dark:text-gray-400 break-all">
            {{ profile.email }}
          </p>

          @if (profile.roles?.length) {
            <div class="mt-2 flex flex-wrap justify-center sm:justify-start gap-1.5">
              @for (role of profile.roles; track $index) {
                <span
                  class="inline-flex items-center rounded-full border border-gray-200 dark:border-gray-700
                         px-2.5 py-0.5 text-xs font-medium text-gray-700 dark:text-gray-200"
                >
                  {{ role }}
                </span>
              }
            </div>
          }
        </div>

        <!-- Бутони (desktop) -->
        <div class="hidden sm:flex flex-col gap-2">
          @if (!isEditing) {
            <button
              type="button"
              (click)="startEdit()"
              class="inline-flex items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-xs font-medium
                     text-gray-700 hover:bg-gray-50 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-800"
            >
              Редактирай профил
            </button>
          } @else {
            <button
              type="button"
              (click)="save()"
              [disabled]="isSaving"
              class="inline-flex items-center justify-center rounded-lg border border-blue-600 px-4 py-2 text-xs font-medium
                     text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-70 dark:border-blue-500"
            >
              {{ isSaving ? 'Запазване...' : 'Запази промените' }}
            </button>

            <button
              type="button"
              (click)="cancelEdit()"
              [disabled]="isSaving"
              class="inline-flex items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-xs font-medium
                     text-gray-700 hover:bg-gray-50 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-800"
            >
              Отказ
            </button>
          }

          <button
            type="button"
            (click)="logout()"
            class="inline-flex items-center justify-center rounded-lg border border-red-500 px-4 py-2 text-xs font-medium
                   text-red-600 hover:bg-red-50 dark:text-red-400 dark:border-red-500 dark:hover:bg-red-950/40"
          >
            Изход
          </button>
        </div>
      </div>

      <hr class="border-gray-200 dark:border-gray-800" />

      <div class="grid gap-6 md:grid-cols-2">
        <!-- Лява колона – инфо -->
        <div class="space-y-4 text-sm">
          <h2 class="text-sm font-semibold text-gray-800 dark:text-gray-200">
            Основна информация
          </h2>

          <div class="space-y-3">
            <div class="flex items-start justify-between">
              <span class="text-gray-500 dark:text-gray-400">Имейл</span>
              <span class="font-medium text-gray-900 dark:text-gray-100 break-all">
                {{ profile.email }}
              </span>
            </div>

            <div class="flex items-start justify-between">
              <span class="text-gray-500 dark:text-gray-400">Име</span>
              <span class="font-medium text-gray-900 dark:text-gray-100">
                {{ profile.firstName || '—' }}
              </span>
            </div>

            <div class="flex items-start justify-between">
              <span class="text-gray-500 dark:text-gray-400">Фамилия</span>
              <span class="font-medium text-gray-900 dark:text-gray-100">
                {{ profile.lastName || '—' }}
              </span>
            </div>

            <div class="flex items-start justify-between">
              <span class="text-gray-500 dark:text-gray-400">Телефон</span>
              <span class="font-medium text-gray-900 dark:text-gray-100">
                {{ profile.phoneNumber || '—' }}
              </span>
            </div>

            <div class="flex items-start justify-between">
              <span class="text-gray-500 dark:text-gray-400">Град</span>
              <span class="font-medium text-gray-900 dark:text-gray-100">
                {{ profile.city || '—' }}
              </span>
            </div>

            <div class="flex items-start justify-between">
              <span class="text-gray-500 dark:text-gray-400">Адрес</span>
              <span class="font-medium text-gray-900 dark:text-gray-100 text-right break-words">
                {{ profile.address || '—' }}
              </span>
            </div>

            @if (profile.createdAt) {
              <div class="flex items-start justify-between">
                <span class="text-gray-500 dark:text-gray-400">Член от</span>
                <span class="font-medium text-gray-900 dark:text-gray-100">
                  {{ profile.createdAt | date:'dd.MM.yyyy' }}
                </span>
              </div>
            }
          </div>
        </div>

        <!-- Дясна колона – редакция -->
        <div class="space-y-4 text-sm">
          <h2 class="text-sm font-semibold text-gray-800 dark:text-gray-200">
            Настройки на профила
          </h2>

          <div class="space-y-3">
            <div>
              <label class="block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1">
                Собствено име
              </label>
              <input
                type="text"
                [(ngModel)]="editModel.firstName"
                name="firstName"
                [disabled]="!isEditing || isSaving"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                       bg-white text-gray-900
                       dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
              />
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1">
                Фамилия
              </label>
              <input
                type="text"
                [(ngModel)]="editModel.lastName"
                name="lastName"
                [disabled]="!isEditing || isSaving"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                       bg-white text-gray-900
                       dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
              />
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1">
                Телефон
              </label>
              <input
                type="text"
                [(ngModel)]="editModel.phoneNumber"
                name="phoneNumber"
                [disabled]="!isEditing || isSaving"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                       bg-white text-gray-900
                       dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
              />
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1">
                Град
              </label>
              <input
                type="text"
                [(ngModel)]="editModel.city"
                name="city"
                [disabled]="!isEditing || isSaving"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                       bg-white text-gray-900
                       dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
              />
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1">
                Адрес
              </label>
              <input
                type="text"
                [(ngModel)]="editModel.address"
                name="address"
                [disabled]="!isEditing || isSaving"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                       bg-white text-gray-900
                       dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
              />
            </div>

            <!-- Бутони за мобилен изглед -->
            <div class="flex flex-col sm:hidden gap-2 pt-2">
              @if (!isEditing) {
                <button
                  type="button"
                  (click)="startEdit()"
                  class="inline-flex items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-xs font-medium
                         text-gray-700 hover:bg-gray-50 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-800"
                >
                  Редактирай профил
                </button>
              } @else {
                <button
                  type="button"
                  (click)="save()"
                  [disabled]="isSaving"
                  class="inline-flex items-center justify-center rounded-lg border border-blue-600 px-4 py-2 text-xs font-medium
                         text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-70 dark:border-blue-500"
                >
                  {{ isSaving ? 'Запазване...' : 'Запази промените' }}
                </button>

                <button
                  type="button"
                  (click)="cancelEdit()"
                  [disabled]="isSaving"
                  class="inline-flex items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-xs font-medium
                         text-gray-700 hover:bg-gray-50 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-800"
                >
                  Отказ
                </button>
              }

              <button
                type="button"
                (click)="logout()"
                class="inline-flex items-center justify-center rounded-lg border border-red-500 px-4 py-2 text-xs font-medium
                       text-red-600 hover:bg-red-50 dark:text-red-400 dark:border-red-500 dark:hover:bg-red-950/40"
              >
                Изход
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  }
</div>
