# Online Clothing Store

Уеб приложение за онлайн магазин за дрехи и аксесоари, реализирано като учебен проект за Технически университет – София (дисциплина „Софтуерни технологии“).

> ⚠ **Важно:** Това **не е реален онлайн магазин**. Поръчките не се обработват и няма реална доставка. Проектът е само демонстрационен.

---

## Съдържание

- [Технологии](#технологии)
- [Основни функционалности](#основни-функционалности)
  - [Публична част (гости)](#публична-част-гости)
  - [Регистрирани потребители](#регистрирани-потребители)
  - [Админ панел](#админ-панел)
- [Сигурност](#сигурност)
  - [Двуфакторна автентикация (2FA)](#двуфакторна-автентикация-2fa)
- [Архитектура и структура на проекта](#архитектура-и-структура-на-проекта)
- [Стартиране локално](#стартиране-локално)
  - [1. Предпоставки](#1-предпоставки)
  - [2. Конфигурация на backend](#2-конфигурация-на-backend)
  - [3. Стартиране на backend](#3-стартиране-на-backend)
  - [4. Стартиране на frontend](#4-стартиране-на-frontend)
- [Конфигурация на среди](#конфигурация-на-среди)
- [Тестове](#тестове)
- [Автори](#автори)

---

## Технологии

**Frontend**

- Angular 19 (standalone компоненти)
- TypeScript
- Tailwind CSS
- Angular Router (публични и admin маршрути)
- Reactive Forms
- HTTP Client за комуникация с API
- Dark / Light тема, базирана на предпочитанията на потребителя / системата
- LocalStorage за кошница на гост и синхронизация при логнат потребител

**Backend**

- ASP.NET Core Web API (.NET 9)
- ASP.NET Core Identity с `ApplicationUser`
- JWT автентикация (`JwtBearer`)
- Entity Framework Core + SQL Server
- Cloudinary за качване и съхранение на продуктови изображения
- MailKit / MimeKit за изпращане на имейли (потвърждение на акаунт, контакт форма и др.)
- PayPal REST API интеграция:
  - създаване на PayPal поръчки
  - потвърждение / capture на плащания
- Speedy интеграция:
  - заявки към Speedy API (GraphQL)
  - избор на офис за доставка
- Слоеста архитектура:
  - Controllers (`ClothingStore` проект)
  - Services (`ClothingStore.Core.Services`)
  - Repositories + DbContext (`ClothingStore.Infrastructure`)

**База данни**

- Microsoft SQL Server
- Identity таблици (потребители, роли)
- Основни таблици:
  - `Products`, `Categories`, `Colors`, `ProductVariants`, `ProductImages`
  - `Orders`, `OrderItems`
  - `Carts`, `CartItems`
  - `UserInteraction` (за препоръки / track-ване на взаимодействия)

---

## Основни функционалности

### Публична част (гости)

- Начална страница с:
  - промоционален банер
  - препоръчани / популярни продукти (препоръки на база `UserInteraction`)
- Каталог продукти:
  - филтри по категория, цвят, размер и други (чрез `ProductFilterDto`)
  - сортиране по цена / дата / популярност
- Детайли за продукт:
  - снимки (от Cloudinary)
  - налични размери и цветове (`ProductVariant`)
  - цена и текуща наличност
- Кошница за гост:
  - пази се в `localStorage` (`CartService`)
  - добавяне / премахване / промяна на количество
- Checkout за гост:
  - въвеждане на име, имейл, телефон, адрес или Speedy офис
  - избор на метод на плащане:
    - наложен платеж
    - PayPal (redirect към PayPal, после обратно към сайта)

> Гостът може да направи поръчка, но няма история на поръчките и профил.

### Регистрирани потребители

- Регистрация:
  - имейл + парола
  - потвърждение на паролата
  - име / фамилия, телефон, град, адрес
  - след успешна регистрация се изпраща имейл за потвърждение
- Потвърждение на имейл:
  - backend: `AuthController.ConfirmEmail`
  - frontend: `/confirm-email` страница, която чете `userId` и `token` от URL и показва статус
  - след потвърждение се отключват всички функционалности за акаунта
- Логин:
  - вход с имейл и парола
  - при успешен логин се връща JWT токен (`AuthResponse`)
  - ако имейлът не е потвърден, backend връща грешка, която frontend показва
- Профил:
  - преглед на профилните данни (`/profile`)
  - редакция на име, фамилия, телефон, град, адрес
- Кошница за логнат потребител:
  - локалната кошница на гост се слива със сервизната при логване
  - пази се в базата (`Cart`, `CartItem`), асоциирана с `ApplicationUser`
- Поръчки:
  - страница „Моите поръчки“ с list на поръчките за текущия потребител
  - детайли за поръчка: продукти, статус, обща сума, метод на плащане
- Препоръки:
  - track-ване на взаимодействия през `RecommendationService`
  - показване на препоръчани продукти (например карусел на началната страница)

### Админ панел

Админ панелът е достъпен само за потребители с роля `Admin` (ролите се seed-ват през миграции).

Основни възможности:

- **Dashboard**
  - обобщена статистика (броя поръчки, оборот, активни продукти и др.)
- **Управление на продукти**
  - създаване / редакция / деактивиране
  - качване на изображения (чрез Cloudinary)
  - управление на вариации: цвят, размер, наличност (`ProductVariant`)
- **Категории и цветове**
  - CRUD за категории (`CategoryController`)
  - CRUD за цветове (`ColorController`)
- **Поръчки**
  - преглед на всички поръчки
  - детайлна информация за конкретна поръчка
  - промяна на статус (`OrderStatus` – Pending, Processing, Completed, Cancelled, Paid)
- **Потребители**
  - списък с потребители
  - базови операции (напр. деактивиране / админ права – през `AdminUsersController` и съответния service)

---

## Сигурност

- ASP.NET Core Identity (`ApplicationUser : IdentityUser`)
- JWT базирана автентикация:
  - claims: UserId, Email, Name, Roles
  - настройки през `JwtSettings` (issuer, audience, security key, expiry)
- Имейл потвърждение:
  - при регистрация се генерира токен за потвърждение
  - изпраща се линк към frontend (`Frontend:BaseUrl`) + `confirm-email` маршрут
  - backend endpoint: `GET /api/Auth/confirm-email`
- Роли:
  - `User`
  - `Admin`
- Валидация на входните данни:
  - data annotations в DTO-тата (`RegisterRequest`, `LoginRequest`, `OrderCreateDto`, и др.)
  - допълнителна валидация в services (например при създаване на поръчка и наличност на вариации)

### Двуфакторна автентикация (2FA)

Проектът включва **двуфакторна автентикация (2FA)** с приложение за еднократни кодове (например **Google Authenticator**):

- 2FA се включва от профила на потребителя (секция за сигурност).
- Генерира се таен ключ / QR код, който потребителят добавя в приложението (Google Authenticator или друго TOTP приложение).
- При вход:
  1. Потребителят въвежда имейл и парола.
  2. Ако за акаунта е активирана 2FA, се изисква допълнителен 6-цифрен код от приложението.
  3. След успешна проверка се издава JWT токен и се позволява достъп до системата.

> Забележка: 2FA е добавена върху ASP.NET Identity и работи с TOTP кодове, съвместими с Google Authenticator.

---

## Архитектура и структура на проекта

Репото е организирано в две основни части:

```text
Online-Clothing-Store/
  Backend/
    ClothingStore.sln
    ClothingStore/                 # ASP.NET Core Web API
    ClothingStore.Core/            # Домейн модели и бизнес логика (Services, DTO-та)
    ClothingStore.Infrastructure/  # EF Core, DbContext, Entities, Repositories, Migrations
    ClothingStore.UnitTests/       # Unit тестове за услуги
  Frontend/
    angular.json
    package.json
    src/
      main.ts
      app.config.ts
      app.routes.ts
      components/      # public + admin компоненти
      services/        # auth, products, cart, orders, PayPal, recommendations, theme
      guards/          # auth guard, admin guard
      models/          # TypeScript модели за DTO-тата от API-то
      pipes/, enums/, interceptor/, environments/
